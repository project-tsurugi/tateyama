# 構成ファイルのパラメーター

tsurugiの構成ファイルは下記のようなiniファイル形式でコンフィグパラメーターを設定する事ができる。

```
[section]
parameter=value
```

下記にセクションごとにサポートされるパラメーターの一覧を列挙する。

## ccセクション
セクション名
  - cc

対象コンポーネント

  - トランザクショナルKVS(shirakami)

|                  パラメーター名 | 型 | 値                   | 備考                                                                                                                                                           |
|-------------------------:| :---: |:--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| epoch_duration  | 整数 | エポックの長さ(us)。デフォルトは3000。 |
| waiting_resolver_threads | 整数 | コミット待ちとなったLTX群の待ち判定とプレコミット処理を行うスレッド数。デフォルト2。 |

## datastoreセクション

セクション名
  - datastore

対象コンポーネント

  - データストア
  - トランザクショナルKVS(shirakami)

|                  パラメーター名 | 型 | 値                   | 備考                                                                                                                                                           |
|-------------------------:| :---: |:--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
|             log_location | 文字列 | ログを保存するディレクトリへの絶対パス | デフォルトはshirakamiの決めるデフォルトパス([database_options::log_directory_path_の記述](https://github.com/project-tsurugi/shirakami/blob/master/docs/database_options.md)を参照) |
|  recover_max_parallelism | 整数 | リカバリ時の同時並行作業数。デフォルトは 8 | 開発用のため将来的に削除/変更される可能性あり |

## sqlセクション

セクション名
  - sql

対象コンポーネント
  - SQLサービス・リソース(jogasaki)

|パラメーター名 | 型 | 値 |備考|
|---:| :---: | :--- |---|
|thread_pool_size | 整数 | SQLサービスが使用するタスクスケジューラの使用するスレッド数。デフォルトは次式により環境に合わせて設定される。MIN( <既定ワーカー係数> * <物理コア数>, <最大既定ワーカー数> ) 結果が1未満になる場合は1とする。ここで、既定ワーカー係数 = 0.8、最大既定ワーカー数 = 32||
|enable_index_join | ブール(true/false) | 性能向上のためインデックスを利用した結合処理を行うか。デフォルトはfalse|開発用のため将来的に削除される可能性あり|
|stealing_enabled | ブール(true/false) | 空いたCPUコアを活用するためにスケジューラーがタスクのstealingを行うか。デフォルトはtrue||
|default_partitions | 整数 | 並列化可能な関係演算子の実行においてデータ分割を行う際のパーティション数。デフォルトは5||
|use_preferred_worker_for_current_thread | ブール(true/false) | スケジューラーがワーカーを選択する際、タスクを提出したスレッドごとに固定的なワーカーを使うようにするか。デフォルトはtrue|開発用のため将来的に削除される可能性あり|
|stealing_wait| 整数 | タスクスケジューラのワーカーがスティーリングを行う前に自身のタスクキューを余分にチェックする回数の係数。`<ワーカー数> * <stealing_wait>` 回だけ自身のタスクキューを多くチェックするようになる。デフォルトは1|開発用のため将来的に削除/変更される可能性あり|
|task_polling_wait| 整数 | タスクスケジューラのワーカーが自身のタスクキューやスティール候補のポーリングに失敗した際、次のポーリングまでスリープする時間(us)。デフォルトは0|開発用のため将来的に削除/変更される可能性あり|
|tasked_write | ブール(true/false) | INSERT文の操作をタスクを作成して行うか。デフォルトはtrue|開発用のため将来的に削除される可能性あり|
|enable_hybrid_scheduler| ブール(true/false) | ハイブリッドスケジューラを使用するか。デフォルトはtrue|開発用のため将来的に削除される可能性あり|
|lightweight_job_level| 整数 | 短時間で終わるジョブを定義する閾値。設定値以下のlevelを持つジョブが短時間で終わるジョブとして分類され、リクエストスレッドで実行される候補となる。0を指定すると全てのジョブは短時間でないものとして扱われる。デフォルトは0。enable_hybrid_scheduler=trueのときのみ有効。|開発用のため将来的に削除/変更される可能性あり|
|busy_worker| ブール(true/false) | タスクスケジューラのワーカーが高頻度でタスクキューをチェックするか。デフォルトはfalse|開発用のため将来的に削除される可能性あり|
|watcher_interval| 整数 | タスクスケジューラの条件確認スレッドが一時停止してから次に再開するまでの間隔(us)。デフォルトは1000|開発用のため将来的に削除/変更される可能性あり|
|worker_try_count| 整数 | タスクスケジューラのワーカーがサスペンド前にタスクキューを確認する回数。busy_worker=falseの場合のみ有効。デフォルトは1000|開発用のため将来的に削除/変更される可能性あり|
|worker_suspend_timeout| 整数 | タスクスケジューラのワーカーがサスペンドしてから復帰するまでの時間(us)。busy_worker=falseの場合のみ有効。デフォルトは1000000|開発用のため将来的に削除/変更される可能性あり|
|commit_response| 文字列 | commit待ち合わせの既定値。次のいずれかから選択 (ACCEPTED, AVAILABLE, STORED, PROPAGATED)。デフォルトはPROPAGATED|クライアントからコミット時に明示的に指定することで、トランザクションごとに上記設定を上書き可能|
|dev_update_skips_deletion| ブール(true/false) | UPDATE文の更新対象列が主キーや索引列でない場合はレコードの削除を可能な限りスキップする。デフォルトはfalse|開発用のため将来的に削除される可能性あり|
|dev_profile_commits| ブール(true/false) | コミット処理の性能計測のためのプロファイリング情報を出力するか。デフォルトはfalse|開発用のため将来的に削除される可能性あり|

## ipc_endpointセクション

セクション名
  - ipc_endpoint

対象コンポーネント
  - ipc_endpoint(tateyama)

|パラメーター名 | 型 | 値 |備考|
|---:| :---: | :--- |---|
|database_name | 文字列 | ipc_endpointに接続する際のurl名、デフォルトはtsurugi。 | この文字列は/dev/shmに作成されるファイル名のprefixとして使われる。
|threads | 整数 | ipc_endpointの最大同時接続数、デフォルトは104。
|datachannel_buffer_size | 整数 | resultsetのbuffer size、単位はKB、デフォルトは64。 | ipcで扱える最大のraw sizeはdatachannel_buffer_size-4B。
|max_datachannel_buffers | 整数 | 1セッションで同時使用可能なwriterの数。デフォルト値は256。 | このパラメータはセッションに対する上限値であり、システム（データベース・インスタンス）全体に対する上限値ではない。

## stream_endpointセクション

セクション名
  - stream_endpoint

対象コンポーネント
  - stream_endpoint(tateyama)

|パラメーター名 | 型 | 値 |備考|
|---:| :---: | :--- |---|
|port | 整数 | stream_endpointに接続する際のport番号、デフォルトは12345
|threads | 整数 | stream_endpointの最大同時接続数、デフォルトは104

## sessionセクション

セクション名
  - session

対象コンポーネント
  - セッションを利用するtateyamaのコンポーネント全て

|パラメーター名 | 型 | 値 |備考|
|---:| :---: | :--- |---|
|enable_timeout | ブール(true/false) | セッションの自動タイムアウトの有効性、デフォルト値はtrue
|refresh_timeout | 整数 | 通信によるセッションのライフタイム延長時間(秒)、デフォルト値は300
|max_refresh_timeout | 整数 | 明示的な要求によるセッションのライフタイム延長時間の最大値(秒)、デフォルト値は10800

## systemセクション

セクション名
  - system

対象コンポーネント
  - tateyama-bootstrap

|パラメーター名 | 型 | 値 |備考|
|---:| :---: | :--- |---|
|pid_directory | 文字列 | .pidファイル([プロセスの排他制御について](https://github.com/project-tsurugi/tateyama/blob/master/docs/process-mutex-ja.md)を参照)を作成する一時ディレクトリを指定する、デフォルト値は/var/lock。

## glogセクション

セクション名
  - glog

対象コンポーネント
  - glog（logger）

|パラメーター名 | 型 | 値 |備考|
|---:| :---: | :--- |---|
|logtostderr | ブール(true/false) | ログファイルを出力せず、代わりに標準エラー出力にすべてのメッセージを出力する。デフォルト値はfalse。 |
|stderrthreshold | 整数 | 標準エラー出力に出力するログレベルの閾値。デフォルト値は2（ERRORに相当）。|
|minloglevel | 整数 | 出力するログレベル。デフォルト値は0（INFOに相当） |
|log_dir | 文字列 | ログファイルの出力先ディレクトリ。デフォルトは未指定（glogの既定のディレクトリに出力）。 |
|max_log_size | 整数 | ログファイルの最大サイズ。デフォルト値は未指定。 |
|v | 数値 | 出力する詳細ログのレベル。デフォルト値は0（出力しない）。|
|logbuflevel | 数値 | バッファリングするログのレベル。レベルがこの値以下のログはバッファリングされる。デフォルト値は0。|

## ディレクトリの相対パス指定について
ディレクトリを指定するパラメータで相対パスが設定された場合、環境変数 TSURUGI_HOME からの相対パスとなります。
環境変数 TSURUGI_HOME が設定されていない場合はその相対パスは解決できないため、tsurugidbの起動は失敗します。
なお、すべてのディレクトリが絶対パスで指定されている場合は、tsurugidb起動に環境変数 TSURUGI_HOME の設定は関与しません。
